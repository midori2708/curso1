(function(){var t,e,n,r,o,a,i,u,l,c,s,h,p,f,d,g,m,v,y,T,C,w,D,$,S=[].slice,x=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};t=window.jQuery||window.Zepto||window.$,t.payment={},t.payment.fn={},t.fn.payment=function(){var e,n;return n=arguments[0],e=2<=arguments.length?S.call(arguments,1):[],t.payment.fn[n].apply(this,e)},o=/(\d{1,4})/g,t.payment.cards=r=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:o,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:o,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^(5[1-5]|2[2-7])/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",pattern:/^3[0689]/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^6([045]|22)/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^(62|88)/,format:o,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:o,length:[16],cvcLength:[3],luhn:!0}],e=function(t){var e,n,o;for(t=(t+"").replace(/\D/g,""),n=0,o=r.length;n<o;n++)if(e=r[n],e.pattern.test(t))return e},n=function(t){var e,n,o;for(n=0,o=r.length;n<o;n++)if(e=r[n],e.type===t)return e},p=function(t){var e,n,r,o,a,i;for(r=!0,o=0,n=(t+"").split("").reverse(),a=0,i=n.length;a<i;a++)e=n[a],e=parseInt(e,10),(r=!r)&&(e*=2),e>9&&(e-=9),o+=e;return o%10==0},h=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)||!document.selection.createRange().text)},D=function(t,e){var n,r;try{n=e.prop("selectionStart")}catch(o){o,n=null}if(r=e.val(),e.val(t),null!==n&&e.is(":focus"))return n===r.length&&(n=t.length),e.prop("selectionStart",n),e.prop("selectionEnd",n)},v=function(t){var e,n,r,o,a,i,u,l;for(null==t&&(t=""),r="０１２３４５６７８９",o="0123456789",i="",n=t.split(""),u=0,l=n.length;u<l;u++)e=n[u],a=r.indexOf(e),a>-1&&(e=o[a]),i+=e;return i},m=function(e){return setTimeout(function(){var n,r;return n=t(e.currentTarget),r=n.val(),r=v(r),r=r.replace(/\D/g,""),D(r,n)})},d=function(e){return setTimeout(function(){var n,r;return n=t(e.currentTarget),r=n.val(),r=v(r),r=t.payment.formatCardNumber(r),D(r,n)})},u=function(n){var r,o,a,i,u,l,c;if(a=String.fromCharCode(n.which),/^\d+$/.test(a)&&(r=t(n.currentTarget),c=r.val(),o=e(c+a),i=(c.replace(/\D/g,"")+a).length,l=16,o&&(l=o.length[o.length.length-1]),!(i>=l||null!=r.prop("selectionStart")&&r.prop("selectionStart")!==c.length)))return u=o&&"amex"===o.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,u.test(c)?(n.preventDefault(),setTimeout(function(){return r.val(c+" "+a)})):u.test(c+a)?(n.preventDefault(),setTimeout(function(){return r.val(c+a+" ")})):void 0},a=function(e){var n,r;if(n=t(e.currentTarget),r=n.val(),8===e.which&&(null==n.prop("selectionStart")||n.prop("selectionStart")===r.length))return/\d\s$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s$/,""))})):/\s\d?$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d$/,""))})):void 0},g=function(e){return setTimeout(function(){var n,r;return n=t(e.currentTarget),r=n.val(),r=v(r),r=t.payment.formatExpiry(r),D(r,n)})},l=function(e){var n,r,o;if(r=String.fromCharCode(e.which),/^\d+$/.test(r))return n=t(e.currentTarget),o=n.val()+r,/^\d$/.test(o)&&"0"!==o&&"1"!==o?(e.preventDefault(),setTimeout(function(){return n.val("0"+o+" / ")})):/^\d\d$/.test(o)?(e.preventDefault(),setTimeout(function(){return n.val(o+" / ")})):void 0},c=function(e){var n,r,o;if(r=String.fromCharCode(e.which),/^\d+$/.test(r))return n=t(e.currentTarget),o=n.val(),/^\d\d$/.test(o)?n.val(o+" / "):void 0},s=function(e){var n,r,o;if("/"===(o=String.fromCharCode(e.which))||" "===o)return n=t(e.currentTarget),r=n.val(),/^\d$/.test(r)&&"0"!==r?n.val("0"+r+" / "):void 0},i=function(e){var n,r;if(n=t(e.currentTarget),r=n.val(),8===e.which&&(null==n.prop("selectionStart")||n.prop("selectionStart")===r.length))return/\d\s\/\s$/.test(r)?(e.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s\/\s$/,""))})):void 0},f=function(e){return setTimeout(function(){var n,r;return n=t(e.currentTarget),r=n.val(),r=v(r),r=r.replace(/\D/g,"").slice(0,4),D(r,n)})},w=function(t){var e;return!(!t.metaKey&&!t.ctrlKey)||32!==t.which&&(0===t.which||(t.which<33||(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))))},T=function(n){var r,o,a,i;if(r=t(n.currentTarget),a=String.fromCharCode(n.which),/^\d+$/.test(a)&&!h(r))return i=(r.val()+a).replace(/\D/g,""),o=e(i),o?i.length<=o.length[o.length.length-1]:i.length<=16},C=function(e){var n,r,o;if(n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!h(n))return o=n.val()+r,o=o.replace(/\D/g,""),!(o.length>6)&&void 0},y=function(e){var n,r,o;if(n=t(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!h(n))return o=n.val()+r,o.length<=4},$=function(e){var n,o,a,i,u;if(n=t(e.currentTarget),u=n.val(),i=t.payment.cardType(u)||"unknown",!n.hasClass(i))return o=function(){var t,e,n;for(n=[],t=0,e=r.length;t<e;t++)a=r[t],n.push(a.type);return n}(),n.removeClass("unknown"),n.removeClass(o.join(" ")),n.addClass(i),n.toggleClass("identified","unknown"!==i),n.trigger("payment.cardType",i)},t.payment.fn.formatCardCVC=function(){return this.on("keypress",w),this.on("keypress",y),this.on("paste",f),this.on("change",f),this.on("input",f),this},t.payment.fn.formatCardExpiry=function(){return this.on("keypress",w),this.on("keypress",C),this.on("keypress",l),this.on("keypress",s),this.on("keypress",c),this.on("keydown",i),this.on("change",g),this.on("input",g),this},t.payment.fn.formatCardNumber=function(){return this.on("keypress",w),this.on("keypress",T),this.on("keypress",u),this.on("keydown",a),this.on("keyup",$),this.on("paste",d),this.on("change",d),this.on("input",d),this.on("input",$),this},t.payment.fn.restrictNumeric=function(){return this.on("keypress",w),this.on("paste",m),this.on("change",m),this.on("input",m),this},t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())},t.payment.cardExpiryVal=function(t){var e,n,r,o;return o=t.split(/[\s\/]+/,2),e=o[0],r=o[1],2===(null!=r?r.length:void 0)&&/^\d+$/.test(r)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),r=n+r),e=parseInt(e,10),r=parseInt(r,10),{month:e,year:r}},t.payment.validateCardNumber=function(t){var n,r;return t=(t+"").replace(/\s+|-/g,""),!!/^\d+$/.test(t)&&(!!(n=e(t))&&(r=t.length,x.call(n.length,r)>=0&&(!1===n.luhn||p(t))))},t.payment.validateCardExpiry=function(e,n){var r,o,a;return"object"==typeof e&&"month"in e&&(a=e,e=a.month,n=a.year),!(!e||!n)&&(e=t.trim(e),n=t.trim(n),!!/^\d+$/.test(e)&&(!!/^\d+$/.test(n)&&(1<=e&&e<=12&&(2===n.length&&(n=n<70?"20"+n:"19"+n),4===n.length&&(o=new Date(n,e),r=new Date,o.setMonth(o.getMonth()-1),o.setMonth(o.getMonth()+1,1),o>r)))))},t.payment.validateCardCVC=function(e,r){var o,a;return e=t.trim(e),!!/^\d+$/.test(e)&&(o=n(r),null!=o?(a=e.length,x.call(o.cvcLength,a)>=0):e.length>=3&&e.length<=4)},t.payment.cardType=function(t){var n;return t?(null!=(n=e(t))?n.type:void 0)||null:null},t.payment.formatCardNumber=function(n){var r,o,a,i;return n=n.replace(/\D/g,""),(r=e(n))?(a=r.length[r.length.length-1],n=n.slice(0,a),r.format.global?null!=(i=n.match(r.format))?i.join(" "):void 0:null!=(o=r.format.exec(n))?(o.shift(),o=t.grep(o,function(t){return t}),o.join(" ")):void 0):n},t.payment.formatExpiry=function(t){var e,n,r,o;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",r=n[2]||"",o=n[3]||"",o.length>0?r=" / ":" /"===r?(e=e.substring(0,1),r=""):2===e.length||r.length>0?r=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,r=" / "),e+r+o):""}}).call(this),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):window.jQuery)}(function(t){"use strict";window.XDomainRequest&&!t.support.cors&&t.ajaxTransport(function(e){if(e.crossDomain&&e.async){e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout);var n;return{send:function(r,o){function a(e,r,a,i){n.onload=n.onerror=n.ontimeout=t.noop,n=null,o(e,r,a,i)}var i=/\?/.test(e.url)?"&":"?";n=new XDomainRequest,"DELETE"===e.type?(e.url=e.url+i+"_method=DELETE",e.type="POST"):"PUT"===e.type?(e.url=e.url+i+"_method=PUT",e.type="POST"):"PATCH"===e.type&&(e.url=e.url+i+"_method=PATCH",e.type="POST"),n.open(e.type,e.url),n.onload=function(){a(200,"OK",{text:n.responseText},"Content-Type: "+n.contentType)},n.onerror=function(){a(404,"Not Found")},e.xdrTimeout&&(n.ontimeout=function(){a(0,"timeout")},n.timeout=e.xdrTimeout),n.send(e.hasContent&&e.data||null)},abort:function(){n&&(n.onerror=t.noop(),n.abort())}}}})});